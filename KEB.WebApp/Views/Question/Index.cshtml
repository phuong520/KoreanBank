@model IEnumerable<KEB.Application.DTOs.QuestionDTO.QuestionDisplayDto>
@using KEB.Domain.Enums

@{



    ViewBag.Title = "Ngân hàng câu hỏi";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var difficulties = Enum.GetValues(typeof(Difficulty)).Cast<Difficulty>().ToList();

    var skills = Enum.GetValues(typeof(Skill)).Cast<Skill>().ToList();

    var status = Enum.GetValues(typeof(QuestionStatus)).Cast<QuestionStatus>().ToList();
}
<header>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />
    <style>
        .filter-item label {
        font-size: 0.9rem;
        }

        .dropdown-toggle {
        background-color: white;
        border: 1px solid #ced4da;
        text-align: left;
        font-size: 0.9rem;
        }

        .dropdown-toggle::after {
        float: right;
        margin-top: 8px;
        }

        .card {
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        }

        .page-link {
        color: #007bff;
        }

        .page-item.active .page-link {
        background-color: #343a40;
        border-color: #343a40;
        }

        .search-box input {
        border-right: none;
        }

        .search-box .input-group-text {
        background-color: white;
        border-left: none;
        }

        .nav-tabs .nav-link {
        color: #007bff;
        }

        .nav-tabs .nav-link.active {
        font-weight: 500;
        }
    </style>

</header>
<div class="container-fluid">
    <div class="row">
        <!-- Left sidebar with filters -->
        <div class="col-md-3" style="padding: 20px; border-right: 1px solid #e0e0e0;">
            <h2>Ngân hàng câu hỏi</h2>

            <form id="filterForm" method="get" asp-controller="Question" asp-action="Index">
                <div class="mt-4">
                    <h6>Filter</h6>
                    <div class="search-box mt-3">
                        <div class="input-group">
                            <input name="Search" type="text" class="form-control" placeholder="Tìm kiếm">
                            <div class="input-group-append">
                                <span class="input-group-text bg-white">
                                    <i class="fa fa-search"></i>
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- Trạng thái -->
                    <div class="filter-item mt-3">
                        <label class="text-primary mb-1">Trạng thái</label>
                        <div class="dropdown">
                            <select class="form-select" name="Status">
                                <option value="">-- Chọn dạng độ khó --</option>
                                @foreach (var sta in status)
                                {
                                    <option value="@((int)sta)">@sta</option>
                                }
                            </select>
                        </div>
                    </div>
                    <!-- Trình Độ -->
                    <div class="filter-item mt-3">
                        <label class="text-primary mb-1">Trình Độ</label>
                        <div class="dropdown">
                            <select name="LevelIds" class="form-select" asp-items="ViewBag.Levels">
                                <option value="">-- Chọn trình độ --</option>
                            </select>
                        </div>
                    </div>

                    <!-- Dạng Câu Hỏi -->
                    <div class="filter-item mt-3">
                        <label class="text-primary mb-1">Dạng Câu Hỏi</label>
                        <div class="dropdown">
                            <select name="QuestionTypeIds" class="form-select" asp-items="ViewBag.QuestionTypes">
                                <option value="">-- Chọn dạng câu hỏi --</option>
                            </select>
                        </div>
                    </div>

                    <!-- Mức Độ -->
                    <div class="filter-item mt-3">
                        <label class="text-primary mb-1">Độ khó</label>
                        <div class="dropdown">
                            <select class="form-select" name="Difficulty">
                                <option value="">-- Chọn dạng độ khó --</option>
                                @foreach (var diff in difficulties)
                                {
                                    <option value="@((int)diff)">@diff</option>
                                }
                            </select>
                        </div>
                    </div>

                    <!-- Loại Câu Hỏi -->
                    <div class="filter-item mt-3">
                        <label class="text-primary mb-1">Loại Câu Hỏi</label>
                        <div class="dropdown">
                            <select name="IsMultipleChoice" class="form-select">
                                <option value="">-- Chọn loại câu hỏi -- </option>
                                <option value="True">Trắc nghiệm</option>
                                <option value="False">Tự luận</option>
                            </select>
                        </div>
                    </div>

                    <!-- Nguồn Tham Khảo -->
                    <div class="filter-item mt-3">
                        <label class="text-primary mb-1">Nguồn Tham Khảo</label>
                        <div class="dropdown">
                            <select name="ReferenceIds" class="form-select" asp-items="ViewBag.References">
                                <option value="">-- Chọn nguồn tham khảo --</option>
                            </select>
                        </div>
                    </div>

                    <!-- Chủ Đề -->
                    <div class="filter-item mt-3">
                        <label class="text-primary mb-1">Chủ Đề</label>
                        <div class="dropdown">
                            <select name="TopicIds" class="form-select" asp-items="ViewBag.Topics">
                                <option value="">-- Chọn chủ đề --</option>
                            </select>
                        </div>
                    </div>
                    <input type="submit" class="btn btn-primary mt-3" value="Lọc câu hỏi" />
                </div>
            </form>
        </div>

        <!-- Right content with question list -->
        <!-- Right content with question list -->
        <div class="col-md-9" style="padding: 20px;">
            <!-- Tabs -->
            <ul class="nav nav-tabs">
                @foreach (var skill in skills)
                {
                    var isActive = (int)skill == 0 ? "active" : "";
                    <li class="nav-item">
                        <a class="nav-link @isActive" href="javascript:void(0);" data-skill="@skill.ToString().ToLower()">@skill</a>
                    </li>
                }
            </ul>

            <div class="tab-content mt-3">
                <div class="tab-pane active" id="nghe">
                    <h5 class="mb-4">Danh Sách Câu Hỏi</h5>

                    @foreach (var question in Model)
                    {
                        <div class="card mb-3">
                            <div class="card-body">
                                <!-- Handle attachments -->
                                @if (question.AttachmentAudio != null)
                                {

                                    <div class="mb-2">
                                        <audio controls class="audio-preview mb-3">
                                            <source src="data:audio/*;base64,@question.AttachmentAudio" type="audio/mpeg">
                                            Trình duyệt của bạn không hỗ trợ audio.
                                        </audio>
                                    </div>
                                }
                                @if ((question.AttachmentImage != null))
                                {
                                    <div class="mb-2">
                                        <img src="data:Image/*;base64,@question.AttachmentImage" alt="Question Image" class="img-fluid" style="max-width: 100%; max-height: 100px;" />
                                    </div>

                                }

                                <div class="d-flex justify-content-between">
                                    <h6 class="card-title">@question.QuestionContent</h6>
                                    <div>
                                        <a href="#" class="btn btn-sm btn-outline-secondary mr-1"><i class="fa fa-search"></i></a>
                                        <a href="@Url.Action("Edit", "Question", new { id = question.Id })" class="btn btn-sm btn-outline-primary">
                                            <i class="fa fa-eye"></i>
                                        </a>
                                    </div>
                                </div>
                                <div class="mt-2">
                                    @if (question.Answers != null && question.Answers.Any())
                                    {
                                        int index = 0;
                                        foreach (var answer in question.Answers)
                                        {
                                            var label = ((char)('A' + index)).ToString();
                                            <div class="mb-1">
                                                <strong>@label.</strong> @answer.Content
                                            </div>
                                            index++;
                                        }
                                    }
                                    else
                                    {
                                        <p class="text-danger">Không có đáp án nào.</p>
                                    }
                                </div>
                                <div class="mt-3 text-muted">
                                    <small>
                                        @question.LevelName | @question.QuestionTypeName | @question.SkillName | @question.ReferenceName | @question.TopicName
                                    </small>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>


@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            // Initialize dropdowns
            $('.dropdown-toggle').dropdown();

            // Add active class to selected dropdown items
            $('.dropdown-item').on('click', function() {
                const selected = $(this).text();
                $(this).closest('.dropdown').find('.dropdown-toggle').text(selected);
            });
        });
    </script>
    <script>
        $(document).ready(function () {
            // Submit form khi chọn filter
            $('#filterForm select').on('change', function () {
                // $('#filterForm').submit();
            });

            // Skill tab click
            $('.nav-link').on('click', function () {
                const selectedSkill = $(this).data('skill');
                const form = $('#filterForm');

                // Thêm input ẩn chứa skill
                if (form.find('input[name="Skill"]').length === 0) {
                    form.append(`<input type="hidden" name="Skill" value="${selectedSkill}" />`);
                } else {
                    form.find('input[name="Skill"]').val(selectedSkill);
                }

                form.submit();
            });
        });
    </script>
}